<form
  class="page"
  [formGroup]="form"
  (ngSubmit)="submit()"
>

  <!-- Título -->
  <div class="header">
    <h2>Tempo Juntos</h2>
    <p>São poucos passos para um presente único</p>
  </div>

  <!-- Vamos começar -->
  <mat-card>
    <h3>Vamos começar</h3>

    <mat-form-field appearance="outline">
      <mat-label>Nome pessoa 1</mat-label>
      <input matInput formControlName="nome1" />

      <mat-error *ngIf="hasError('nome1','required')">
        Campo obrigatório
      </mat-error>

      <mat-error *ngIf="hasError('nome1','minlength')">
        Mínimo de 2 caracteres
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Nome pessoa 2</mat-label>
      <input matInput formControlName="nome2" />

      <mat-error *ngIf="hasError('nome2','required')">
        Campo obrigatório
      </mat-error>

      <mat-error *ngIf="hasError('nome2','minlength')">
        Mínimo de 2 caracteres
      </mat-error>
    </mat-form-field>
  </mat-card>

  <!-- Nosso Dia -->
  <mat-card class="center">
    <h3>Nosso Dia</h3>

    <mat-form-field appearance="outline">
      <mat-label>Data especial</mat-label>
      <input
        matInput
        [matDatepicker]="picker"
        formControlName="dataEspecial"
      />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>

      <mat-error *ngIf="f.dataEspecial.touched && f.dataEspecial.errors">
        Data obrigatória
      </mat-error>
    </mat-form-field>

    <small *ngIf="form.value.dataEspecial">
      {{ form.value.dataEspecial | date:'dd/MM/yyyy' }}
    </small>
  </mat-card>

  <!-- Nossos Momentos -->
  <mat-card>
    <h3 class="center">Nossos Momentos</h3>

    <input
      type="file"
      hidden
      multiple
      accept="image/*"
      #fileInput
      (change)="onSelecionarFotos($event)"
    />

    <div class="photos-wrapper">
      <button
        type="button"
        mat-icon-button
        class="scroll-btn left"
        (click)="scrollLeft()"
        *ngIf="showScrollButtons">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <div
        class="photos"
        #scrollContainer
        cdkDropList
        cdkDropListOrientation="horizontal"
        (cdkDropListDropped)="drop($event)"
      >
        <div
          class="photo"
          *ngFor="let foto of fotos; let i = index"
          cdkDrag
        >
          <img [src]="foto.preview" />

          <button
            mat-icon-button
            color="warn"
            type="button"
            (click)="removerFoto(i)"
          >
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>

      <button
        type="button"
        mat-icon-button
        class="scroll-btn right"
        (click)="scrollRight()"
        *ngIf="showScrollButtons">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>

    <button
      mat-stroked-button
      color="warn"
      class="full"
      type="button"
      (click)="fileInput.click()"
    >
      Selecionar fotos
    </button>

    <small *ngIf="fotos.length">
      Arraste as fotos para definir a ordem
    </small>

    <small class="error" *ngIf="!fotos.length && form.touched">
      Adicione pelo menos uma foto
    </small>
  </mat-card>

  <!-- Música -->
  <mat-card>
    <h3>Música</h3>

    <div style="display: flex; gap: 8px; align-items: center;" *ngIf="!musicaSelecionada">
      <mat-form-field appearance="outline" class="full" [class.shake]="shakeInput">
        <mat-label>Link do YouTube</mat-label>
        <input matInput formControlName="musica" />
      </mat-form-field>

      <button
        mat-icon-button
        color="primary"
        type="button"
        (click)="confirmarLinkExterno()"
      >
        <mat-icon>check</mat-icon>
      </button>
    </div>

    <app-lista-video-youtube
      [sugestoes]="videoManual ? [videoManual] : musicasSugeridas"
      [ngModel]="musicaSelecionada"
      (ngModelChange)="onVideoSelecionado($event)"
      [ngModelOptions]="{standalone: true}">
    </app-lista-video-youtube>
  </mat-card>

  <!-- Mensagem -->
  <mat-card>
    <h3 class="center">O mais importante</h3>

    <mat-form-field appearance="outline">
      <mat-label>Mensagem especial</mat-label>
      <textarea matInput rows="4" formControlName="mensagem"></textarea>

      <mat-error *ngIf="hasError('mensagem','required')">
        Campo obrigatório
      </mat-error>

      <mat-error *ngIf="hasError('mensagem','minlength')">
        Mínimo de 10 caracteres
      </mat-error>
    </mat-form-field>
  </mat-card>

  <!-- Plano -->
  <mat-card class="center">
    <h3>Plano</h3>

    <div class="plans">
      <button mat-stroked-button type="button"
        [color]="form.value.plano === 'sempre' ? 'primary' : ''"
        (click)="form.patchValue({ plano: 'sempre' })">
        Para Sempre
      </button>

      <button mat-stroked-button type="button"
        [color]="form.value.plano === 'ano' ? 'primary' : ''"
        (click)="form.patchValue({ plano: 'ano' })">
        Por 1 Ano
      </button>

      <button mat-stroked-button type="button"
        [color]="form.value.plano === 'mes' ? 'primary' : ''"
        (click)="form.patchValue({ plano: 'mes' })">
        Por 1 Mês
      </button>
    </div>

    <mat-error *ngIf="f.plano.touched && f.plano.errors">
      Escolha um plano
    </mat-error>
  </mat-card>

  <!-- Contato -->
  <mat-card>
    <mat-form-field appearance="outline" class="full">
      <mat-label>Email</mat-label>
      <mat-icon matPrefix>email</mat-icon>
      <input matInput type="email" formControlName="email" />

      <mat-error *ngIf="hasError('email','required')">
        Email é obrigatório
      </mat-error>

      <mat-error *ngIf="hasError('email','email')">
        Email inválido
      </mat-error>
    </mat-form-field>

    <div style="display: flex; gap: 8px;">
      <!-- DDI -->
      <app-select-codigo-pais formControlName="ddi" style="width:160px;"></app-select-codigo-pais>

      <!-- Telefone -->
      <mat-form-field appearance="outline" class="full">
        <mat-label>Telefone</mat-label>
        <mat-icon matPrefix>phone</mat-icon>
        <input matInput type="tel" formControlName="telefone" />

        <mat-error *ngIf="hasError('telefone','required')">
          Telefone é obrigatório
        </mat-error>

        <mat-error *ngIf="hasError('telefone','pattern')">
          Número inválido
        </mat-error>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="full">
      <mat-label>Senha</mat-label>
      <mat-icon matPrefix>lock</mat-icon>

      <input
        matInput
        [type]="esconderSenha ? 'password' : 'text'"
        formControlName="senha"
      />

      <button
        mat-icon-button
        matSuffix
        type="button"
        (click)="esconderSenha = !esconderSenha">
        <mat-icon>
          {{ esconderSenha ? 'visibility_off' : 'visibility' }}
        </mat-icon>
      </button>

      <mat-error *ngIf="hasError('senha','required')">
        Senha é obrigatória
      </mat-error>

      <mat-error *ngIf="hasError('senha','minlength')">
        Mínimo de 6 caracteres
      </mat-error>
    </mat-form-field>
  </mat-card>

  <!-- Submit -->
  <button
    mat-raised-button
    color="primary"
    class="full"
    type="submit"
    [disabled]="form.invalid || !fotos.length"
  >
    Continuar
  </button>

</form>
